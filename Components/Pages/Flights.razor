@page "/flights"
@using BlazorHybridApp.Data

<h3 class="text-center">Flight Finder</h3>

<div class="d-flex gap-2">
    <div class="d-flex flex-column w-100">
        <label for="from">From:</label>
        <input id="from" @bind="from" placeholder="Any" class="form-control h-100"/>
    </div>
    <div class="d-flex flex-column w-100">
        <label for="to">To:</label>
        <input id="to" @bind="to" placeholder="Any" class="form-control h-100" />
    </div>
    <div class="d-flex flex-column w-100">
        <label for="day">Day:</label>
        <input id="day" @bind="day" placeholder="Any" class="form-control h-100"  />
    </div>
    <div class="d-flex flex-column w-100">
        <label>&nbsp;</label> 
        <button @onclick="SearchFlights" class="btn btn-primary w-100 h-100">Find flights</button>
    </div>
</div> 

<br />

<div>
    <h3 class="text-center">Flights</h3>
    <div class="border rounded">
        @if (flights == null || !flights.Any())
        {
            <p> Loading...</p>
        }
        else
        {
            <div>
                @foreach (var flight in flights)
                {
                    <p> @flight </p>
                }
            </div>
        }
    </div>
</div>

<br />

<h3 class="text-center">Reserve </h3>
<form>
    <div>
        <label>Flight Code:</label>
        <input @bind=reservation.Fcode type="text" class="form-control" placeholder="Flight Code">
    </div>
    <div>
        <label>Airline:</label>
        <input @bind="reservation.Aname" type="text" class="form-control" placeholder="Airline">
    </div>
    <div>
        <label>Day:</label>
        <input @bind="day" type="text" class="form-control" placeholder="Day">
    </div>
    <div>
        <label>Time:</label>
        <input @bind="time" type="text" class="form-control" placeholder="Time">
    </div>
    <div>
        <label>Cost:</label>
        <input @bind="reservation.Cost" type="text" class="form-control" placeholder="0">
    </div>
    <div>
        <label>Name:</label>
        <input @bind="reservation.Cname" type="text" class="form-control" placeholder="Name">
    </div>
    <div>
        <label>Citizenship:</label>
        <input @bind="reservation.Citizenship" type="text" class="form-control" placeholder="Citizenship">
    </div>
    <br />
    <button @onclick="ReserveFlight" class="btn btn-primary">Reserve</button> 
</form>

@code {







    public string flight;
    public string airline;
    public string time;
    public string cost;
    public string name;
    public string citizenship;
    private string from;
    private string to;
    private string day;
    private List<Flight> flights;

    Reservation reservation { get; set; } = new Reservation();

    private async Task SearchFlights()
    {
        if (!string.IsNullOrWhiteSpace(from) && !string.IsNullOrWhiteSpace(to) && !string.IsNullOrWhiteSpace(day))
        {
            flights = await Task.Run(() => FlightManagement.FlightsFound(from, to, day));
        }

    }

    private string GenerateRandomRCode()
    {
        Random rand = new Random();
        char letter = (char)rand.Next('A', 'Z' + 1); // Generate a random uppercase letter
        int number = rand.Next(100, 1000); // Generate a three-digit number
        return $"{letter}{number}";
    }

    private async Task ReserveFlight()
    {

        string rcode = GenerateRandomRCode();

        var newReservation = new Reservation
            {
                Rcode = rcode,
                Fcode = reservation.Fcode,
                Aname = reservation.Aname,
                Cost = reservation.Cost,
                Cname = reservation.Cname,
                Citizenship = reservation.Citizenship,
                Status = "Active"
            };

        // Add to reservation list and update JSON
        ReservationManager.resList.Add(newReservation);

    }
}
